<!DOCTYPE html<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema ERP</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .login-box { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); width: 100%; max-width: 400px; }
        .login-box h2 { text-align: center; color: #333; margin-bottom: 10px; font-size: 28px; }
        .login-subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 14px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #555; font-weight: 500; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 14px; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        .login-btn { width: 100%; padding: 14px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; }
        .login-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(102,126,234,0.4); }
        .error-message { color: #ef4444; font-size: 14px; margin-top: 15px; padding: 12px; background: #fee; border-radius: 8px; display: none; }
        .error-message.show { display: block; }
        .login-info { margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; }
        .login-info p { font-size: 13px; color: #1e40af; margin: 5px 0; }
        #erpSystem { display: none; background: #f4f4f4; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 30px; border-radius: 12px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
        header h1 { font-size: 24px; }
        .logo { background: white; color: #667eea; padding: 8px 16px; border-radius: 8px; font-weight: bold; margin-right: 10px; }
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab { background: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; color: #666; }
        .tab:hover { background: #f0f0f0; }
        .tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .content { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px; border-radius: 12px; }
        .stat-value { font-size: 32px; font-weight: bold; margin-bottom: 8px; }
        .stat-label { font-size: 14px; opacity: 0.9; }
        .section { margin-bottom: 30px; }
        .section h2 { color: #333; margin-bottom: 20px; font-size: 20px; }
        table { width: 100%; border-collapse: collapse; }
        table thead { background: #f9fafb; }
        table th { padding: 12px; text-align: left; font-weight: 600; color: #374151; border-bottom: 2px solid #e5e7eb; font-size: 13px; }
        table td { padding: 12px; border-bottom: 1px solid #f3f4f6; color: #6b7280; font-size: 14px; }
        table tr:hover { background: #f9fafb; }
        .badge { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; }
        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
        button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 500; transition: all 0.3s; }
        button:hover { transform: translateY(-2px); }
        .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .btn-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .search-bar { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .search-bar input { flex: 1; min-width: 200px; padding: 10px 14px; border: 2px solid #e5e7eb; border-radius: 8px; }
        .alert { padding: 16px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
        .alert-success { background: #d1fae5; color: #065f46; border-left: 4px solid #10b981; }
        .alert-danger { background: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444; }
        .code-display { background: #f9fafb; padding: 20px; border-radius: 8px; text-align: center; margin-top: 20px; }
        #qrcode, #barcode { margin: 20px auto; }
    </style>
</head>
<body>
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h2>Sistema ERP</h2>
            <p class="login-subtitle">Gestão de Estoque</p>
            <form id="loginForm">
                <div class="form-group">
                    <label>Usuário</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label>Senha</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="login-btn">Entrar</button>
                <div class="error-message" id="errorMessage"></div>
            </form>
            <div class="login-info">
                <p><strong>Acesso:</strong> admin / admin123</p>
            </div>
        </div>
    </div>

    <div id="erpSystem">
        <div class="container">
            <header>
                <h1><span class="logo">ERP</span>Sistema de Gestão</h1>
                <span id="currentTime"></span>
            </header>
            <div class="nav-tabs">
                <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
                <button class="tab" onclick="switchTab('products')">Produtos</button>
                <button class="tab" onclick="switchTab('movements')">Movimentações</button>
                <button class="tab" onclick="switchTab('codes')">Códigos</button>
            </div>
            <div class="content">
                <div id="dashboard" class="tab-content active">
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-value" id="totalProducts">0</div><div class="stat-label">Produtos</div></div>
                        <div class="stat-card"><div class="stat-value" id="totalStock">0</div><div class="stat-label">Estoque</div></div>
                        <div class="stat-card"><div class="stat-value" id="totalValue">R$ 0</div><div class="stat-label">Valor Total</div></div>
                        <div class="stat-card"><div class="stat-value" id="todayMovements">0</div><div class="stat-label">Movimentações Hoje</div></div>
                    </div>
                    <div class="section">
                        <h2>Estoque Baixo</h2>
                        <table id="lowStockTable"><thead><tr><th>SKU</th><th>Produto</th><th>Qtd</th><th>Status</th></tr></thead><tbody></tbody></table>
                    </div>
                    <div class="section">
                        <h2>Últimas Movimentações</h2>
                        <table id="recentMovements"><thead><tr><th>Data</th><th>Produto</th><th>Tipo</th><th>Qtd</th><th>Usuário</th></tr></thead><tbody></tbody></table>
                    </div>
                </div>
                <div id="products" class="tab-content">
                    <div class="section">
                        <h2>Cadastrar Produto</h2>
                        <form id="productForm" class="form-grid">
                            <div class="form-group"><label>SKU</label><input type="text" id="sku" required></div>
                            <div class="form-group"><label>Nome</label><input type="text" id="name" required></div>
                            <div class="form-group"><label>Quantidade</label><input type="number" id="quantity" min="0" required></div>
                            <div class="form-group"><label>Preço</label><input type="number" id="price" step="0.01" min="0" required></div>
                            <div class="form-group"><label>Fornecedor</label><input type="text" id="supplier"></div>
                            <div class="form-group"><label>Estoque Mín</label><input type="number" id="minStock" min="0" value="10"></div>
                            <div class="form-group" style="align-self: flex-end;"><button type="submit">Cadastrar</button></div>
                        </form>
                    </div>
                    <div class="section">
                        <h2>Lista de Produtos</h2>
                        <div class="search-bar">
                            <input type="text" id="searchProduct" placeholder="Buscar..." oninput="searchProducts()">
                            <button onclick="exportCSV()">Exportar</button>
                        </div>
                        <table id="productsTable"><thead><tr><th>ID</th><th>SKU</th><th>Nome</th><th>Qtd</th><th>Preço</th><th>Ações</th></tr></thead><tbody></tbody></table>
                    </div>
                </div>
                <div id="movements" class="tab-content">
                    <div class="section">
                        <h2>Registrar Movimentação</h2>
                        <form id="movementForm" class="form-grid">
                            <div class="form-group"><label>Produto</label><select id="movProductId" required><option value="">Selecione</option></select></div>
                            <div class="form-group"><label>Tipo</label><select id="movType" required><option value="ENTRADA">Entrada</option><option value="SAIDA">Saída</option></select></div>
                            <div class="form-group"><label>Quantidade</label><input type="number" id="movQuantity" min="1" required></div>
                            <div class="form-group"><label>Responsável</label><input type="text" id="movUser" required></div>
                            <div class="form-group"><label>Observações</label><input type="text" id="movNotes"></div>
                            <div class="form-group" style="align-self: flex-end;"><button type="submit" class="btn-success">Registrar</button></div>
                        </form>
                    </div>
                    <div class="section">
                        <h2>Histórico</h2>
                        <table id="movementsTable"><thead><tr><th>ID</th><th>Data</th><th>Produto</th><th>Tipo</th><th>Qtd</th><th>Usuário</th></tr></thead><tbody></tbody></table>
                    </div>
                </div>
                <div id="codes" class="tab-content">
                    <div class="section">
                        <h2>Gerar QR Code e Código de Barras</h2>
                        <div class="form-grid">
                            <div class="form-group"><label>Produto</label><select id="codeProductId"><option value="">Selecione</option></select></div>
                            <div class="form-group"><label>Código Personalizado</label><input type="text" id="customCode"></div>
                            <div class="form-group" style="align-self: flex-end;"><button onclick="generateCodes()">Gerar</button></div>
                        </div>
                        <div class="code-display" id="codeDisplay" style="display: none;">
                            <h3>QR Code</h3>
                            <div id="qrcode"></div>
                            <h3 style="margin-top: 30px;">Código de Barras</h3>
                            <svg id="barcode"></svg>
                            <div style="margin-top: 20px;">
                                <button onclick="downloadQR()">Download QR</button>
                                <button onclick="window.print()">Imprimir</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
let products = [];
let movements = [];

document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const user = document.getElementById('username').value;
    const pass = document.getElementById('password').value;
    const err = document.getElementById('errorMessage');
    
    if (user === 'admin' && sha256(pass) === sha256('admin123')) {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('erpSystem').style.display = 'block';
        init();
        setInterval(() => {
            document.getElementById('currentTime').textContent = new Date().toLocaleString('pt-BR');
        }, 1000);
    } else {
        err.textContent = 'Usuário ou senha incorretos';
        err.classList.add('show');
    }
});

function init() {
    products = [
        {id: 1, sku: '7891234567890', name: 'Rojão Trovão', quantity: 150, price: 12.50, supplier: 'Fogos SP', minStock: 20},
        {id: 2, sku: '7891234567891', name: 'Morteiro 3 Pol', quantity: 45, price: 85.00, supplier: 'Pirotecnia BR', minStock: 10},
        {id: 3, sku: '7891234567892', name: 'Chuva de Prata', quantity: 8, price: 65.00, supplier: 'Fogos MG', minStock: 15}
    ];
    const now = new Date();
    movements = [
        {id: 1, productId: 1, type: 'ENTRADA', quantity: 50, user: 'João', date: new Date(now - 86400000), notes: 'Inicial'},
        {id: 2, productId: 2, type: 'SAIDA', quantity: 5, user: 'Maria', date: new Date(now - 43200000), notes: 'Venda'}
    ];
    update();
}

function update() {
    updateDashboard();
    updateProducts();
    updateMovements();
    updateSelects();
}

function updateDashboard() {
    document.getElementById('totalProducts').textContent = products.length;
    document.getElementById('totalStock').textContent = products.reduce((s, p) => s + p.quantity, 0);
    document.getElementById('totalValue').textContent = fmt(products.reduce((s, p) => s + (p.quantity * p.price), 0));
    const today = new Date().toDateString();
    document.getElementById('todayMovements').textContent = movements.filter(m => m.date.toDateString() === today).length;
    
    const low = products.filter(p => p.quantity <= p.minStock);
    document.querySelector('#lowStockTable tbody').innerHTML = low.length === 0 ? 
        '<tr><td colspan="4" style="text-align:center;color:#999">Nenhum produto</td></tr>' :
        low.map(p => `<tr><td>${p.sku}</td><td>${p.name}</td><td>${p.quantity}</td><td><span class="badge badge-warning">Baixo</span></td></tr>`).join('');
    
    const rec = movements.slice(-10).reverse();
    document.querySelector('#recentMovements tbody').innerHTML = rec.length === 0 ? 
        '<tr><td colspan="5" style="text-align:center;color:#999">Nenhuma movimentação</td></tr>' :
        rec.map(m => {
            const p = products.find(pr => pr.id === m.productId);
            return `<tr><td>${fmtDate(m.date)}</td><td>${p ? p.name : 'N/A'}</td><td><span class="badge badge-${m.type === 'ENTRADA' ? 'success' : 'danger'}">${m.type}</span></td><td>${m.quantity}</td><td>${m.user}</td></tr>`;
        }).join('');
}

function updateProducts() {
    document.querySelector('#productsTable tbody').innerHTML = products.map(p => 
        `<tr><td>${p.id}</td><td>${p.sku}</td><td>${p.name}</td><td>${p.quantity}</td><td>${fmt(p.price)}</td><td><button onclick="delProduct(${p.id})" class="btn-danger" style="padding:6px 12px;font-size:12px">Excluir</button></td></tr>`
    ).join('');
}

function updateMovements() {
    document.querySelector('#movementsTable tbody').innerHTML = movements.slice().reverse().map(m => {
        const p = products.find(pr => pr.id === m.productId);
        return `<tr><td>${m.id}</td><td>${fmtDate(m.date)}</td><td>${p ? p.name : 'N/A'}</td><td><span class="badge badge-${m.type === 'ENTRADA' ? 'success' : 'danger'}">${m.type}</span></td><td>${m.quantity}</td><td>${m.user}</td></tr>`;
    }).join('');
}

function updateSelects() {
    ['movProductId', 'codeProductId'].forEach(id => {
        document.getElementById(id).innerHTML = '<option value="">Selecione</option>' + 
            products.map(p => `<option value="${p.id}">${p.name} (${p.sku})</option>`).join('');
    });
}

function switchTab(tab) {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    event.target.classList.add('active');
    document.getElementById(tab).classList.add('active');
}

document.getElementById('productForm').addEventListener('submit', function(e) {
    e.preventDefault();
    products.push({
        id: products.length > 0 ? Math.max(...products.map(p => p.id)) + 1 : 1,
        sku: document.getElementById('sku').value,
        name: document.getElementById('name').value,
        quantity: parseInt(document.getElementById('quantity').value),
        price: parseFloat(document.getElementById('price').value),
        supplier: document.getElementById('supplier').value,
        minStock: parseInt(document.getElementById('minStock').value)
    });
    update();
    showAlert('Produto cadastrado!', 'success');
    this.reset();
});

document.getElementById('movementForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const prodId = parseInt(document.getElementById('movProductId').value);
    const type = document.getElementById('movType').value;
    const qty = parseInt(document.getElementById('movQuantity').value);
    const prod = products.find(p => p.id === prodId);
    
    if (!prod) return showAlert('Produto não encontrado!', 'danger');
    if (type === 'SAIDA' && prod.quantity < qty) return showAlert('Quantidade insuficiente!', 'danger');
    
    movements.push({
        id: movements.length > 0 ? Math.max(...movements.map(m => m.id)) + 1 : 1,
        productId: prodId,
        type: type,
        quantity: qty,
        user: document.getElementById('movUser').value,
        date: new Date(),
        notes: document.getElementById('movNotes').value
    });
    
    prod.quantity += (type === 'ENTRADA' ? qty : -qty);
    update();
    showAlert('Movimentação registrada!', 'success');
    this.reset();
});

function delProduct(id) {
    if (confirm('Excluir produto?')) {
        products = products.filter(p => p.id !== id);
        update();
        showAlert('Produto excluído!', 'success');
    }
}

function searchProducts() {
    const term = document.getElementById('searchProduct').value.toLowerCase();
    document.querySelectorAll('#productsTable tbody tr').forEach(row => {
        row.style.display = row.textContent.toLowerCase().includes(term) ? '' : 'none';
    });
}

function generateCodes() {
    const prodId = document.getElementById('codeProductId').value;
    const custom = document.getElementById('customCode').value;
    let code = custom;
    
    if (!code && prodId) {
        const p = products.find(pr => pr.id == prodId);
        if (p) code = p.sku;
    }
    
    if (!code) return showAlert('Selecione um produto ou digite um código!', 'danger');
    
    document.getElementById('codeDisplay').style.display = 'block';
    document.getElementById('qrcode').innerHTML = '';
    
    new QRCode(document.getElementById('qrcode'), {text: code, width: 200, height: 200});
    
    try {
        JsBarcode('#barcode', code, {format: 'CODE128', width: 2, height: 100, displayValue: true});
    } catch (e) {
        showAlert('Erro ao gerar código de barras', 'danger');
    }
}

function downloadQR() {
    const canvas = document.querySelector('#qrcode canvas');
    if (!canvas) return;
    const link = document.createElement('a');
    link.download = 'qrcode.png';
    link.href = canvas.toDataURL();
    link.click();
}

function exportCSV() {
    const csv = 'ID;SKU;Nome;Qtd;Preço;Fornecedor\n' +
        products.map(p => `${p.id};${p.sku};${p.name};${p.quantity};${p.price};${p.supplier}`).join('\n');
    const blob = new Blob([csv], {type: 'text/csv'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'produtos.csv';
    link.click();
    showAlert('Exportado!', 'success');
}

function showAlert(msg, type) {
    const a = document.createElement('div');
    a.className = `alert alert-${type}`;
    a.innerHTML = `<span>${type === 'success' ? '✓' : '⚠'}</span>${msg}`;
    document.querySelector('.content').insertBefore(a, document.querySelector('.content').firstChild);
    setTimeout(() => a.remove(), 3000);
}

function fmt(v) { return new Intl.NumberFormat('pt-BR', {style: 'currency', currency: 'BRL'}).format(v); }
function fmtDate(d) { return new Intl.DateTimeFormat('pt-BR', {day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit'}).format(d); }
    </script>
</body>
</html>
