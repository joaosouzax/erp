<dependencies>
    <!-- Web -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <!-- Segurança -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-security</artifactId>
    </dependency>

    <!-- JPA + Banco -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-data-jpa</artifactId>
    </dependency>
    <dependency>
        <groupId>com.h2database</groupId>
        <artifactId>h2</artifactId>
        <scope>runtime</scope>
    </dependency>

    <!-- Excel -->
    <dependency>
        <groupId>org.apache.poi</groupId>
        <artifactId>poi-ooxml</artifactId>
        <version>5.2.3</version>
    </dependency>
</dependencies>
import jakarta.persistence.*;
import lombok.*;

@Entity
@Data
@NoArgsConstructor
@AllArgsConstructor
public class User {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String username;
    private String password; // armazenado com BCrypt
    private String role;     // ADMIN, ESTOQUISTA, VENDEDOR
}
import jakarta.persistence.*;
import lombok.*;

@Entity
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Product {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String sku;
    private String name;
    private int quantity;
}
import jakarta.persistence.*;
import lombok.*;
import java.time.LocalDateTime;

@Entity
@Data
@NoArgsConstructor
@AllArgsConstructor
public class Movement {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String type; // ENTRADA ou SAIDA
    private int quantity;
    private LocalDateTime date;
    @ManyToOne
    private Product product;
    private String user;
}
import org.springframework.context.annotation.*;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
public class SecurityConfig {
    @Bean
    PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }

    @Bean
    SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        return http.csrf().disable()
                .authorizeHttpRequests(auth -> auth
                        .requestMatchers("/login", "/scanner/**").permitAll()
                        .anyRequest().authenticated()
                )
                .httpBasic()
                .and()
                .build();
    }
}
import org.apache.poi.ss.usermodel.*;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.springframework.stereotype.Service;
import java.io.*;
import java.util.List;

@Service
public class ExcelService {
    public byte[] exportProducts(List<Product> products) throws IOException {
        Workbook wb = new XSSFWorkbook();
        Sheet sheet = wb.createSheet("Produtos");
        Row header = sheet.createRow(0);
        header.createCell(0).setCellValue("SKU");
        header.createCell(1).setCellValue("Nome");
        header.createCell(2).setCellValue("Quantidade");

        int rowIdx = 1;
        for(Product p : products){
            Row row = sheet.createRow(rowIdx++);
            row.createCell(0).setCellValue(p.getSku());
            row.createCell(1).setCellValue(p.getName());
            row.createCell(2).setCellValue(p.getQuantity());
        }

        ByteArrayOutputStream out = new ByteArrayOutputStream();
        wb.write(out);
        wb.close();
        return out.toByteArray();
    }
}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Scanner ERP</title>
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
<h2>Escanear Produto</h2>
<div id="reader" style="width:300px;"></div>
<div id="result"></div>

<script>
function onScanSuccess(decodedText) {
  document.getElementById("result").innerText = "Código: " + decodedText;

  // Envia para backend → se existe, baixa 1 unidade; se não, cadastra
  fetch("/api/scan", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ code: decodedText })
  }).then(r => r.json()).then(res => {
    alert(res.message);
  });
}

const html5QrCode = new Html5Qrcode("reader");
html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, onScanSuccess);
</script>
</body>
</html>
import org.springframework.web.bind.annotation.*;
import java.util.*;

@RestController
@RequestMapping("/api")
public class ScanController {
    private final ProductRepository productRepo;
    private final MovementRepository moveRepo;

    public ScanController(ProductRepository productRepo, MovementRepository moveRepo){
        this.productRepo=productRepo;
        this.moveRepo=moveRepo;
    }

    @PostMapping("/scan")
    public Map<String,String> scan(@RequestBody Map<String,String> body){
        String code = body.get("code");
        Product prod = productRepo.findBySku(code).orElse(null);

        if(prod!=null){
            if(prod.getQuantity()>0){
                prod.setQuantity(prod.getQuantity()-1);
                productRepo.save(prod);
                moveRepo.save(new Movement(null,"SAIDA",1,java.time.LocalDateTime.now(),prod,"scanner"));
                return Map.of("message","Produto vendido: "+prod.getName());
            } else {
                return Map.of("message","Sem estoque para: "+prod.getName());
            }
        } else {
            Product novo = new Product(null,code,"Novo Produto",1);
            productRepo.save(novo);
            moveRepo.save(new Movement(null,"ENTRADA",1,java.time.LocalDateTime.now(),novo,"scanner"));
            return Map.of("message","Produto cadastrado com SKU: "+code);
        }
    }
}
