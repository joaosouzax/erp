<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>üéÜ ERP Fogos de Artif√≠cio</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet"/>
<script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  * { box-sizing: border-box; }
  body { 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
  }
  .navbar { 
    box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
    background: linear-gradient(135deg, #ff6b6b 0%, #dc3545 50%, #c92a2a 100%) !important;
  }
  .card { 
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }
  .card-stat { 
    cursor: pointer;
    transform-style: preserve-3d;
  }
  .card-stat:hover { 
    transform: translateY(-8px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.2);
  }
  .card-stat .card-body {
    padding: 2rem 1rem;
  }
  .stat-icon { 
    font-size: 3rem; 
    opacity: 0.9;
    margin-bottom: 1rem;
  }
  .nav-pills .nav-link { 
    color: #495057;
    font-weight: 500;
    margin: 0 0.25rem;
    border-radius: 10px;
    transition: all 0.2s;
  }
  .nav-pills .nav-link:hover { 
    background-color: rgba(220, 53, 69, 0.1);
    color: #dc3545;
  }
  .nav-pills .nav-link.active { 
    background: linear-gradient(135deg, #dc3545 0%, #c92a2a 100%);
    box-shadow: 0 4px 15px rgba(220,53,69,0.4);
  }
  .low-stock { 
    background: linear-gradient(to right, #fff3cd 0%, #ffe8a1 100%) !important; 
  }
  .no-stock { 
    background: linear-gradient(to right, #f8d7da 0%, #f5c2c7 100%) !important; 
  }
  .table-hover tbody tr { 
    transition: all 0.2s;
  }
  .table-hover tbody tr:hover { 
    background-color: #fff5f5;
    transform: scale(1.01);
  }
  #reader { 
    border: 4px solid #dc3545;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(220,53,69,0.3);
  }
  .btn {
    border-radius: 8px;
    font-weight: 500;
    padding: 0.5rem 1.5rem;
    transition: all 0.3s;
  }
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }
  .badge {
    padding: 0.5rem 0.8rem;
    font-weight: 500;
  }
  #loginBox {
    animation: fadeInUp 0.5s ease;
    border: none;
    background: white;
  }
  .alert {
    border-radius: 10px;
    border: none;
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes slideIn {
    from { transform: translateX(400px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes slideOut {
    from { transform: translateX(0); opacity: 1; }
    to { transform: translateX(400px); opacity: 0; }
  }
  
  .fire-icon {
    animation: flicker 2s infinite;
  }
  
  @keyframes flicker {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.8; }
  }
</style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-dark sticky-top">
  <div class="container-fluid">
    <span class="navbar-brand mb-0 h1">
      <i class="bi bi-fire fire-icon"></i> ERP Fogos de Artif√≠cio
    </span>
    <div class="d-flex align-items-center text-white">
      <span id="userInfo" style="display:none;" class="me-3">
        <i class="bi bi-person-circle"></i> <span id="userName"></span>
      </span>
      <button id="logoutBtn" class="btn btn-outline-light btn-sm" style="display:none;" onclick="logout()">
        <i class="bi bi-box-arrow-right"></i> Sair
      </button>
    </div>
  </div>
</nav>

<div class="container py-4">
  
  <!-- ==================== LOGIN ==================== -->
  <div id="loginBox" class="card p-5 mx-auto shadow-lg" style="max-width:500px; margin-top:80px;">
    <div class="text-center mb-4">
      <i class="bi bi-fire text-danger fire-icon" style="font-size: 5rem;"></i>
      <h2 class="mt-3 fw-bold">ERP Fogos</h2>
      <p class="text-muted">Sistema de Gest√£o Completo</p>
    </div>
    
    <form onsubmit="login(event)">
      <div class="mb-3">
        <label class="form-label fw-bold">
          <i class="bi bi-person-fill"></i> Usu√°rio
        </label>
        <input id="user" class="form-control form-control-lg" placeholder="Digite seu usu√°rio" required autofocus/>
      </div>
      
      <div class="mb-4">
        <label class="form-label fw-bold">
          <i class="bi bi-lock-fill"></i> Senha
        </label>
        <input id="pass" type="password" class="form-control form-control-lg" placeholder="Digite sua senha" required/>
      </div>
      
      <button type="submit" class="btn btn-danger btn-lg w-100 mb-3">
        <i class="bi bi-box-arrow-in-right"></i> Acessar Sistema
      </button>
      
      <div id="loginResult" class="text-center"></div>
      
      <div class="alert alert-light border mt-3 mb-0">
        <small class="text-muted">
          <i class="bi bi-info-circle"></i> <strong>Acesso padr√£o:</strong><br>
          üë§ <strong>admin</strong> / admin123<br>
          üë§ <strong>operador</strong> / op123
        </small>
      </div>
    </form>
  </div>

  <!-- ==================== SISTEMA ==================== -->
  <div id="erpBox" style="display:none;">
    
    <!-- MENU -->
    <ul class="nav nav-pills mt-4 mb-4 shadow-sm p-3 bg-white rounded">
      <li class="nav-item">
        <a class="nav-link active" onclick="showTab('dash')" style="cursor:pointer">
          <i class="bi bi-speedometer2"></i> Dashboard
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showTab('products')" style="cursor:pointer">
          <i class="bi bi-box-seam"></i> Produtos
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showTab('movs')" style="cursor:pointer">
          <i class="bi bi-arrow-left-right"></i> Movimenta√ß√µes
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showTab('scan')" style="cursor:pointer">
          <i class="bi bi-qr-code-scan"></i> Scanner
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" onclick="showTab('sales')" style="cursor:pointer">
          <i class="bi bi-cart-check"></i> Vendas
        </a>
      </li>
    </ul>

    <!-- DASHBOARD -->
    <div id="dash">
      <div class="row g-4 mb-4">
        <div class="col-md-3">
          <div class="card card-stat bg-primary text-white h-100">
            <div class="card-body text-center">
              <i class="bi bi-box-seam stat-icon"></i>
              <h1 class="display-3 fw-bold mb-0" id="totProds">0</h1>
              <p class="mb-0 mt-2">Produtos</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card card-stat bg-success text-white h-100">
            <div class="card-body text-center">
              <i class="bi bi-boxes stat-icon"></i>
              <h1 class="display-3 fw-bold mb-0" id="totStock">0</h1>
              <p class="mb-0 mt-2">Em Estoque</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card card-stat bg-warning text-white h-100">
            <div class="card-body text-center">
              <i class="bi bi-exclamation-triangle stat-icon"></i>
              <h1 class="display-3 fw-bold mb-0" id="lowStock">0</h1>
              <p class="mb-0 mt-2">Alertas</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card card-stat bg-info text-white h-100">
            <div class="card-body text-center">
              <i class="bi bi-arrow-repeat stat-icon"></i>
              <h1 class="display-3 fw-bold mb-0" id="totMovs">0</h1>
              <p class="mb-0 mt-2">Movimenta√ß√µes</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="row g-4">
        <div class="col-lg-8">
          <div class="card">
            <div class="card-header bg-danger text-white">
              <h5 class="mb-0"><i class="bi bi-bar-chart-fill"></i> Estoque por Produto</h5>
            </div>
            <div class="card-body p-4">
              <canvas id="chartStock" height="80"></canvas>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card">
            <div class="card-header bg-warning text-dark">
              <h5 class="mb-0"><i class="bi bi-bell-fill"></i> Alertas de Estoque</h5>
            </div>
            <div class="card-body" style="max-height: 450px; overflow-y: auto;">
              <div id="lowStockList"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- PRODUTOS -->
    <div id="products" style="display:none;">
      <div class="card mb-4">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0"><i class="bi bi-plus-circle-fill"></i> Cadastrar Produto</h5>
        </div>
        <div class="card-body p-4">
          <form onsubmit="addProduct(event)">
            <div class="row g-3">
              <div class="col-md-2">
                <label class="form-label fw-bold">SKU *</label>
                <input id="sku" class="form-control" placeholder="Ex: FOG001" required/>
              </div>
              <div class="col-md-3">
                <label class="form-label fw-bold">Nome *</label>
                <input id="name" class="form-control" placeholder="Ex: Roj√£o Bomba" required/>
              </div>
              <div class="col-md-2">
                <label class="form-label fw-bold">Categoria</label>
                <select id="category" class="form-select">
                  <option>Fogos</option>
                  <option>Bombas</option>
                  <option>Roj√µes</option>
                  <option>Traques</option>
                  <option>Espadas</option>
                  <option>Morteiros</option>
                  <option>Outros</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label fw-bold">Quantidade</label>
                <input id="quantity" type="number" class="form-control" value="0" min="0"/>
              </div>
              <div class="col-md-2">
                <label class="form-label fw-bold">Pre√ßo (R$)</label>
                <input id="price" type="number" step="0.01" class="form-control" placeholder="0.00"/>
              </div>
              <div class="col-md-1 d-flex align-items-end">
                <button type="submit" class="btn btn-success w-100">
                  <i class="bi bi-check-lg"></i>
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <div class="card">
        <div class="card-header bg-dark text-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="bi bi-list-ul"></i> Produtos Cadastrados</h5>
          <button class="btn btn-sm btn-light" onclick="loadData()">
            <i class="bi bi-arrow-clockwise"></i> Atualizar
          </button>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-dark">
                <tr>
                  <th class="px-4">SKU</th>
                  <th>Nome</th>
                  <th>Categoria</th>
                  <th class="text-center">Estoque</th>
                  <th>Pre√ßo</th>
                  <th class="text-center">Status</th>
                  <th class="text-center">A√ß√µes</th>
                </tr>
              </thead>
              <tbody id="prodTable">
                <tr><td colspan="7" class="text-center py-4 text-muted">Carregando...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- MOVIMENTA√á√ïES -->
    <div id="movs" style="display:none;">
      <div class="card">
        <div class="card-header bg-info text-white d-flex justify-content-between">
          <h5 class="mb-0"><i class="bi bi-clock-history"></i> Hist√≥rico</h5>
          <button class="btn btn-sm btn-light" onclick="loadData()">
            <i class="bi bi-arrow-clockwise"></i>
          </button>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-sm table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th class="px-4">Data/Hora</th>
                  <th>Produto</th>
                  <th class="text-center">Tipo</th>
                  <th class="text-center">Qtd</th>
                  <th>Usu√°rio</th>
                  <th>Motivo</th>
                </tr>
              </thead>
              <tbody id="movTable">
                <tr><td colspan="6" class="text-center py-4">Carregando...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- SCANNER -->
    <div id="scan" style="display:none;">
      <div class="row g-4">
        <div class="col-lg-6">
          <div class="card">
            <div class="card-header bg-warning">
              <h5 class="mb-0"><i class="bi bi-qr-code-scan"></i> Scanner</h5>
            </div>
            <div class="card-body text-center p-4">
              <div id="reader" class="mb-3" style="max-width:400px; margin:0 auto;"></div>
              <button class="btn btn-danger w-100" onclick="stopScanner()">
                <i class="bi bi-stop-circle-fill"></i> Parar
              </button>
              <p class="text-muted mt-3 mb-0"><small>Aponte para o c√≥digo de barras</small></p>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0"><i class="bi bi-info-circle-fill"></i> Resultado</h5>
            </div>
            <div class="card-body">
              <div id="scanResult" class="text-center py-5">
                <i class="bi bi-upc-scan text-muted" style="font-size:5rem;"></i>
                <p class="text-muted mt-3">Aguardando leitura...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- VENDAS -->
    <div id="sales" style="display:none;">
      <div class="card">
        <div class="card-header bg-success text-white d-flex justify-content-between">
          <h5 class="mb-0"><i class="bi bi-cart-check-fill"></i> Vendas</h5>
          <button class="btn btn-sm btn-light" onclick="loadData()">
            <i class="bi bi-arrow-clockwise"></i>
          </button>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th class="px-4">#ID</th>
                  <th>Data/Hora</th>
                  <th>Cliente</th>
                  <th class="text-end">Total</th>
                  <th>Usu√°rio</th>
                </tr>
              </thead>
              <tbody id="salesTable">
                <tr><td colspan="5" class="text-center py-4">Carregando...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
const API_URL = 'http://localhost:8080/api';
let currentUser = null, role = null, qrScanner = null, stockChart = null;

function login(e) {
  e.preventDefault();
  fetch(`${API_URL}/login`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({username: user.value, password: pass.value})
  })
  .then(r => r.json())
  .then(res => {
    if(res.status === 'ok') {
      currentUser = res.username;
      role = res.role;
      loginBox.style.display = 'none';
      erpBox.style.display = 'block';
      userInfo.style.display = 'block';
      logoutBtn.style.display = 'block';
      userName.textContent = res.fullName + ' (' + res.role + ')';
      loadData();
      toast('Bem-vindo!', 'success');
    } else {
      loginResult.innerHTML = '<div class="alert alert-danger"><i class="bi bi-x-circle"></i> ' + (res.message || 'Erro') + '</div>';
    }
  })
  .catch(() => loginResult.innerHTML = '<div class="alert alert-danger">Erro de conex√£o</div>');
}

function logout() {
  if(confirm('Sair do sistema?')) {
    erpBox.style.display = 'none';
    loginBox.style.display = 'block';
    userInfo.style.display = 'none';
    logoutBtn.style.display = 'none';
    pass.value = '';
    toast('Logout realizado', 'info');
  }
}

function showTab(id) {
  document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
  event.target.closest('.nav-link').classList.add('active');
  ['dash','products','movs','scan','sales'].forEach(t => document.getElementById(t).style.display = 'none');
  document.getElementById(id).style.display = 'block';
  if(id === 'scan') startScanner();
  else if(qrScanner) stopScanner();
}

function loadData() {
  fetch(`${API_URL}/products`).then(r=>r.json()).then(list => {
    prodTable.innerHTML = '';
    let alerts = '', lowCount = 0;
    list.forEach(p => {
      let status = p.quantity === 0 ? {class:'no-stock',badge:'danger',text:'SEM ESTOQUE'} :
                   p.quantity <= (p.minStock||5) ? {class:'low-stock',badge:'warning text-dark',text:'BAIXO'} :
                   {class:'',badge:'success',text:'OK'};
      if(p.quantity <= (p.minStock||5)) {
        lowCount++;
        alerts += `<div class="alert alert-${p.quantity===0?'danger':'warning'} py-2 mb-2">
          <strong>${p.name}</strong><br><small>Estoque: ${p.quantity}</small></div>`;
      }
      prodTable.innerHTML += `<tr class="${status.class}">
        <td class="px-4"><strong>${p.sku}</strong></td>
        <td>${p.name}</td>
        <td><span class="badge bg-secondary">${p.category||'N/A'}</span></td>
        <td class="text-center"><h5 class="mb-0">${p.quantity}</h5></td>
        <td>R$ ${(p.price||0).toFixed(2)}</td>
        <td class="text-center"><span class="badge bg-${status.badge}">${status.text}</span></td>
        <td class="text-center">
          <button class="btn btn-sm btn-primary" onclick="ajustar(${p.id},'${p.name}',${p.quantity})">
            <i class="bi bi-pencil"></i></button>
        </td></tr>`;
    });
    lowStockList.innerHTML = alerts || '<p class="text-center text-muted">Sem alertas</p>';
    totProds.textContent = list.length;
    totStock.textContent = list.reduce((s,p) => s+p.quantity, 0);
    lowStock.textContent = lowCount;
    updateChart(list);
  });
  
  fetch(`${API_URL}/movements`).then(r=>r.json()).then(list => {
    movTable.innerHTML = '';
    list.forEach(m => {
      let t = m.type==='ENTRADA'?{c:'success',i:'arrow-down-circle'}:
              m.type==='SAIDA'?{c:'danger',i:'arrow-up-circle'}:{c:'warning',i:'arrow-repeat'};
      movTable.innerHTML += `<tr><td class="px-4"><small>${fmt(m.date)}</small></td>
        <td>${m.product?.name||'N/A'}</td>
        <td class="text-center"><span class="badge bg-${t.c}"><i class="bi bi-${t.i}"></i> ${m.type}</span></td>
        <td class="text-center"><strong>${m.quantity}</strong></td>
        <td>${m.user||'-'}</td><td>${m.reason||'-'}</td></tr>`;
    });
    totMovs.textContent = list.length;
  });
  
  fetch(`${API_URL}/sales`).then(r=>r.json()).then(list => {
    salesTable.innerHTML = '';
    list.forEach(s => {
      salesTable.innerHTML += `<tr><td class="px-4">#${s.id}</td><td>${fmt(s.date)}</td>
        <td>${s.customer||'Cliente'}</td>
        <td class="text-end"><strong class="text-success">R$ ${s.total.toFixed(2)}</strong></td>
        <td>${s.user||'-'}</td></tr>`;
    });
  });
}

function updateChart(list) {
  if(stockChart) stockChart.destroy();
  let top = list.sort((a,b) => b.quantity-a.quantity).slice(0,10);
  stockChart = new Chart(chartStock, {
    type: 'bar',
    data: {
      labels: top.map(p => p.name),
      datasets: [{label:'Estoque', data:top.map(p=>p.quantity), 
        backgroundColor:'rgba(220,53,69,0.8)', borderColor:'#dc3545', borderWidth:2}]
    },
    options: {responsive:true, plugins:{legend:{display:false}}, 
      scales:{y:{beginAtZero:true, ticks:{stepSize:1}}}}
  });
}

function addProduct(e) {
  e.preventDefault();
  fetch(`${API_URL}/products`, {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      sku:sku.value, name:name.value, category:category.value,
      quantity:parseInt(quantity.value)||0, price:parseFloat(price.value)||0, minStock:5
    })
  }).then(() => { toast('Produto cadastrado!','success'); e.target.reset(); loadData(); });
}

function ajustar(id, nome, qtd) {
  let nova = prompt(`Ajustar "${nome}"\nAtual: ${qtd}\n\nNova quantidade:`);
  if(!nova) return;
  let motivo = prompt('Motivo:') || 'Ajuste';
  fetch(`${API_URL}/movements/adjust`, {
    method:'POST', headers:{'Content-Type':'application/json'},
    body:JSON.stringify({productId:id, quantity:parseInt(nova), reason:motivo, user:currentUser})
  }).then(()=> { toast('Ajustado!','success'); loadData(); });
}

function startScanner() {
  if(qrScanner) return;
  qrScanner = new Html5Qrcode("reader");
  qrScanner.start({facingMode:"environment"}, {fps:10, qrbox:250}, code => {
    scanResult.innerHTML = '<div class="spinner-border text-danger"></div><p class="mt-2">'+code+'</p>';
    fetch(`${API_URL}/scan`, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body:JSON.stringify({code, user:currentUser})
    }).then(r=>r.json()).then(res => {
      let ico = res.status==='ok'?'check-circle-fill':res.status==='warning'?'exclamation-triangle-fill':'info-circle-fill';
      let cls = res.status==='ok'?'success':res.status==='warning'?'warning':'info';
      scanResult.innerHTML = `<div class="alert alert-${cls}">
        <i class="bi bi-${ico}" style="font-size:3rem;"></i>
        <h4 class="mt-3">${res.message}</h4>
        ${res.product?`<hr><p><strong>${res.product.name}</strong><br>
        Estoque: <span class="badge bg-${res.product.quantity===0?'danger':res.product.quantity<=5?'warning':'success'} fs-5">
        ${res.product.quantity}</span></p>`:''}
      </div>`;
      loadData();
      playBeep();
      setTimeout(()=>scanResult.innerHTML='<i class="bi bi-upc-scan text-muted" style="font-size:5rem;"></i><p class="text-muted mt-3">Aguardando...</p>',4000);
    });
  }).catch(()=>scanResult.innerHTML='<div class="alert alert-danger">Erro ao acessar c√¢mera</div>');
}

function stopScanner() {
  if(qrScanner) qrScanner.stop().then(()=>{qrScanner=null; scanResult.innerHTML='<p class="text-muted">Scanner parado</p>';});
}

function fmt(d) {
  return new Date(d).toLocaleString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'});
}

function toast(msg, type='info') {
  let colors = {success:'#198754',error:'#dc3545',warning:'#ffc107',info:'#0dcaf0'};
  let icons = {success:'check-circle-fill',error:'x-circle-fill',warning:'exclamation-triangle-fill',info:'info-circle-fill'};
  let div = document.createElement('div');
  div.style.cssText = `position:fixed;top:20px;right:20px;background:${colors[type]};color:#fff;padding:15px 25px;border-radius:10px;box-shadow:0 4px 20px rgba(0,0,0,0.3);z-index:9999;animation:slideIn 0.3s;`;
  div.innerHTML = `<i class="bi bi-${icons[type]}"></i> ${msg}`;
  document.body.appendChild(div);
  setTimeout(()=>{div.style.animation='slideOut 0.3s';setTimeout(()=>div.remove(),300);},3000);
}

function playBeep() {
  let ctx = new AudioContext();
  let osc = ctx.createOscillator();
  let gain = ctx.createGain();
  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.frequency.value = 800;
  osc.type = 'sine';
  gain.gain.setValueAtTime(0.3, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
  osc.start(ctx.currentTime);
  osc.stop(ctx.currentTime + 0.1);
}

window.addEventListener('DOMContentLoaded', () => {
  console.log('üéÜ ERP Fogos iniciado!');
  fetch(`${API_URL}/products`).then(r => {
    if(r.ok) console.log('‚úÖ API conectada');
  }).catch(() => alert('‚ö†Ô∏è Servidor n√£o est√° rodando!\nInicie o backend: mvn spring-boot:run'));
});
</script>

</body>
</html>