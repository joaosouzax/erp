<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sistema ERP - Multiusu√°rios</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
<style>
/* (mantive seu CSS anterior, adicionei s√≥ ajustes) */
body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height: 100vh; margin:0; }
header { background:linear-gradient(135deg,#667eea,#764ba2); color:white; padding:14px 20px; border-radius:10px; display:flex; align-items:center; justify-content:space-between; flex-wrap:wrap; }
.nav-tabs { margin:14px 0; display:flex; gap:8px; flex-wrap:wrap; }
.tab { padding:10px 16px; border-radius:8px; background:white; border:none; cursor:pointer; }
.tab.active { background:linear-gradient(135deg,#667eea,#764ba2); color:white; }
.content { background:white; padding:18px; border-radius:10px; }
table { width:100%; border-collapse:collapse; margin-top:12px; }
th,td { padding:8px; border-bottom:1px solid #ddd; text-align:left; }
.btn-danger { background:#dc2626; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
.btn-success { background:#059669; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
</style>
</head>
<body>
<!-- LOGIN -->
<div id="loginPage" style="display:flex;justify-content:center;align-items:center;height:100vh;">
  <div style="background:white;padding:20px;border-radius:8px;width:100%;max-width:400px;">
    <h2>Login ERP</h2>
    <form id="loginForm">
      <input id="username" placeholder="Usu√°rio" required style="width:100%;margin:6px 0;"><br>
      <input id="password" type="password" placeholder="Senha" required style="width:100%;margin:6px 0;"><br>
      <button type="submit" class="btn-success" style="width:100%;">Entrar</button>
    </form>
    <div id="errorMessage" style="color:#dc2626;margin-top:8px;"></div>
    <div style="margin-top:10px;font-size:14px;color:#333;">
      <b>Contas de teste:</b> admin/admin123 ‚Ä¢ estoquista/1234 ‚Ä¢ vendedor/venda
    </div>
  </div>
</div>

<!-- SISTEMA -->
<div id="erpSystem" style="display:none;padding:20px;">
  <header>
    <h1>ERP Sistema</h1>
    <div id="currentUserDisplay"></div>
    <button onclick="logout()" class="btn-danger" id="logoutBtn" style="display:none;">Sair</button>
  </header>

  <div class="nav-tabs">
    <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
    <button class="tab" onclick="switchTab('products')">Produtos</button>
    <button class="tab" onclick="switchTab('movements')">Movimenta√ß√µes</button>
    <button class="tab" onclick="switchTab('users')">Usu√°rios</button>
  </div>

  <div class="content">
    <!-- DASHBOARD -->
    <div id="dashboard" class="tab-content">Bem-vindo ao ERP!</div>

    <!-- PRODUTOS -->
    <div id="products" class="tab-content" style="display:none;">
      <h3>Cadastrar Produto</h3>
      <form id="productForm">
        <input id="sku" placeholder="SKU" required>
        <input id="name" placeholder="Nome" required>
        <input id="quantity" type="number" min="0" required>
        <button class="btn-success">Cadastrar</button>
      </form>
      <table id="productsTable"><thead><tr><th>ID</th><th>SKU</th><th>Nome</th><th>Qtd</th><th>A√ß√µes</th></tr></thead><tbody></tbody></table>
    </div>

    <!-- MOVIMENTA√á√ïES -->
    <div id="movements" class="tab-content" style="display:none;">
      <h3>Registrar Movimenta√ß√£o</h3>
      <form id="movementForm">
        <select id="movProductId"></select>
        <select id="movType"><option value="ENTRADA">Entrada</option><option value="SAIDA">Sa√≠da</option></select>
        <input id="movQuantity" type="number" min="1" required>
        <button class="btn-success">Registrar</button>
      </form>
      <table id="movementsTable"><thead><tr><th>ID</th><th>Produto</th><th>Tipo</th><th>Qtd</th></tr></thead><tbody></tbody></table>
    </div>

    <!-- USU√ÅRIOS -->
    <div id="users" class="tab-content" style="display:none;">
      <h3>Gerenciar Usu√°rios</h3>
      <form id="userForm">
        <input id="newUser" placeholder="Usu√°rio" required>
        <input id="newPass" placeholder="Senha" required>
        <select id="newRole">
          <option value="admin">Admin</option>
          <option value="estoquista">Estoquista</option>
          <option value="vendedor">Vendedor</option>
        </select>
        <button class="btn-success">Adicionar</button>
      </form>
      <table id="usersTable"><thead><tr><th>ID</th><th>Usu√°rio</th><th>Papel</th><th>A√ß√µes</th></tr></thead><tbody></tbody></table>
    </div>
  </div>
</div>

<script>
/* ===== Dados locais ===== */
let users = [
  {id:1, username:"admin", password:sha256("admin123"), role:"admin"},
  {id:2, username:"estoquista", password:sha256("1234"), role:"estoquista"},
  {id:3, username:"vendedor", password:sha256("venda"), role:"vendedor"}
];
let products=[], movements=[];
let currentUser=null;

/* ===== Login ===== */
document.getElementById("loginForm").addEventListener("submit",e=>{
  e.preventDefault();
  const u=document.getElementById("username").value;
  const p=sha256(document.getElementById("password").value);
  const found=users.find(x=>x.username===u && x.password===p);
  if(found){
    currentUser=found;
    document.getElementById("loginPage").style.display="none";
    document.getElementById("erpSystem").style.display="block";
    document.getElementById("logoutBtn").style.display="inline-block";
    document.getElementById("currentUserDisplay").innerText=`üë§ ${currentUser.username} (${currentUser.role})`;
    updateUI();
  } else {
    document.getElementById("errorMessage").innerText="Usu√°rio ou senha incorretos.";
    document.getElementById("errorMessage").style.display="block";
  }
});
function logout(){
  currentUser=null;
  document.getElementById("loginPage").style.display="flex";
  document.getElementById("erpSystem").style.display="none";
}

/* ===== UI ===== */
function switchTab(tab){
  document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
  document.querySelectorAll(".tab-content").forEach(c=>c.style.display="none");
  document.getElementById(tab).style.display="block";
  event.target.classList.add("active");
}
function updateUI(){ updateUsers(); updateProducts(); updateMovements(); updateSelects(); }

/* ===== Usu√°rios ===== */
document.getElementById("userForm").addEventListener("submit",e=>{
  e.preventDefault();
  if(currentUser.role!=="admin"){ alert("Apenas admin pode criar usu√°rios."); return; }
  const id=users.length?Math.max(...users.map(x=>x.id))+1:1;
  const u=document.getElementById("newUser").value;
  const p=sha256(document.getElementById("newPass").value);
  const r=document.getElementById("newRole").value;
  users.push({id,username:u,password:p,role:r});
  updateUsers();
  e.target.reset();
});
function delUser(id){
  if(currentUser.role!=="admin"){ alert("Apenas admin pode excluir usu√°rios."); return; }
  users=users.filter(u=>u.id!==id);
  updateUsers();
}
function updateUsers(){
  const tb=document.querySelector("#usersTable tbody");
  tb.innerHTML=users.map(u=>`<tr><td>${u.id}</td><td>${u.username}</td><td>${u.role}</td>
  <td><button class="btn-danger" onclick="delUser(${u.id})">Excluir</button></td></tr>`).join("");
}

/* ===== Produtos ===== */
document.getElementById("productForm").addEventListener("submit",e=>{
  e.preventDefault();
  const id=products.length?Math.max(...products.map(x=>x.id))+1:1;
  products.push({id,sku:document.getElementById("sku").value,name:document.getElementById("name").value,quantity:parseInt(document.getElementById("quantity").value)});
  updateProducts();
  updateSelects();
  e.target.reset();
});
function delProduct(id){ if(currentUser.role!=="admin"){alert("Apenas admin");return;} products=products.filter(p=>p.id!==id); updateProducts(); }
function updateProducts(){
  const tb=document.querySelector("#productsTable tbody");
  tb.innerHTML=products.map(p=>`<tr><td>${p.id}</td><td>${p.sku}</td><td>${p.name}</td><td>${p.quantity}</td>
  <td><button class="btn-danger" onclick="delProduct(${p.id})">Excluir</button></td></tr>`).join("");
}

/* ===== Movimenta√ß√µes ===== */
document.getElementById("movementForm").addEventListener("submit",e=>{
  e.preventDefault();
  const id=movements.length?Math.max(...movements.map(x=>x.id))+1:1;
  const pid=parseInt(document.getElementById("movProductId").value);
  const type=document.getElementById("movType").value;
  const qty=parseInt(document.getElementById("movQuantity").value);
  movements.push({id,productId:pid,type,quantity:qty});
  updateMovements();
  e.target.reset();
});
function updateMovements(){
  const tb=document.querySelector("#movementsTable tbody");
  tb.innerHTML=movements.map(m=>{
    const prod=products.find(p=>p.id===m.productId);
    return `<tr><td>${m.id}</td><td>${prod?prod.name:"N/A"}</td><td>${m.type}</td><td>${m.quantity}</td></tr>`;
  }).join("");
}
function updateSelects(){
  const sel=document.getElementById("movProductId");
  sel.innerHTML='<option value="">Selecione</option>'+products.map(p=>`<option value="${p.id}">${p.name}</option>`).join("");
}
</script>
</body>
</html>

